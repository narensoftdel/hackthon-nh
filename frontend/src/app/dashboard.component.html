<div class="dashboard">
  <h2>Sensor Dashboard</h2>
  <div *ngIf="loading">Loading...</div>
  <div *ngIf="error">{{ error }}</div>
  <div *ngIf="!loading && !error">
    <div class="building-view" *ngIf="selectedFloor === null">
      <h3>Building Level View (Averages)</h3>
      <div class="card-container">
        <div class="sensor-card" *ngFor="let sensor of getSensorCards(getBuildingAvgData())" [ngClass]="sensor.status">
          <div class="sensor-icon">{{ sensor.icon }}</div>
          <div class="sensor-type">{{ sensor.label }}</div>
          <div class="sensor-value">{{ sensor.value }}</div>
          <div class="sensor-meta" *ngIf="sensor.meta">{{ sensor.meta }}</div>
        </div>
      </div>
      <div class="floor-list">
        <strong>Floors:</strong>
        <button *ngFor="let floor of sensorData; let i = index" (click)="selectFloor(i+1)">
          Floor {{ i + 1 }}
        </button>
      </div>
    </div>
    <div *ngIf="selectedFloor !== null">
      <button (click)="showBuildingView()">&larr; Back to Building View</button>
      <h3>Floor {{ selectedFloor }}</h3>
      <div class="floor-users" *ngIf="getUsersForFloor(selectedFloor).length">
        <strong>Users on this floor:</strong>
        <ul>
          <li *ngFor="let user of getUsersForFloor(selectedFloor)">
            {{ user.name }} ({{ user.email }})
          </li>
        </ul>
      </div>
      <div style="margin-bottom: 1em;">
        <label style="display: flex; align-items: center; gap: 1em;">
          <span>Fire Alarm:</span>
          <input type="checkbox" [checked]="fireAlarmToggle" (change)="onFireAlarmToggle($event)">
          <span>{{ fireAlarmToggle ? 'Active' : 'Inactive' }}</span>
        </label>
        <span *ngIf="alarmEmailStatus">{{ alarmEmailStatus }}</span>
      </div>
      <div class="card-container">
        <div class="sensor-card" *ngFor="let sensor of getSensorCards(sensorData[selectedFloor-1])" [ngClass]="sensor.status">
          <div class="sensor-icon">{{ sensor.icon }}</div>
          <div class="sensor-type">{{ sensor.label }}</div>
          <div class="sensor-value">{{ sensor.value }}</div>
          <div class="sensor-meta" *ngIf="sensor.meta">{{ sensor.meta }}</div>
        </div>
      </div>
    </div>
  </div>
</div>
